# 数据库设计文档

## 一、文档概述
- **文档版本**：1.0
- **适用范围**：个人网站项目开发团队
- **设计目标**：提供清晰的数据模型结构，指导后端数据库实现

## 二、数据库选型
- **数据库类型**：MongoDB（文档型数据库）
- **选择理由**：
  - 适合存储非结构化/半结构化数据（如博客内容、游戏配置）
  - 支持灵活的 schema 设计，便于后期扩展
  - 与 Node.js 技术栈生态兼容性好
  - 提供丰富的查询能力和索引支持

## 三、数据模型设计

### 3.1 用户表（Users）
| 字段名 | 类型 | 约束 | 描述 | 示例 |
|--------|------|------|------|------|
| _id | ObjectId | 主键 | 用户唯一标识 | ObjectId("60d21b4667d0d8992e610c85") |
| username | String | 唯一, 非空 | 用户名 | "john_doe" |
| email | String | 唯一, 非空 | 用户邮箱 | "john@example.com" |
| password | String | 非空 | 加密存储的密码 | "$2b$10$EixZaYb..." |
| avatar | String | 可选 | 头像URL | "https://example.com/avatar.jpg" |
| bio | String | 可选 | 用户简介 | "Frontend developer" |
| role | String | 非空, 默认"user" | 用户角色 | "admin" / "user" |
| createdAt | Date | 非空 | 创建时间 | ISODate("2023-06-20T10:00:00Z") |
| updatedAt | Date | 非空 | 更新时间 | ISODate("2023-06-20T10:00:00Z") |

**索引**：
- 唯一索引：email, username
- 普通索引：role

### 3.2 文章表（Articles）
| 字段名 | 类型 | 约束 | 描述 | 示例 |
|--------|------|------|------|------|
| _id | ObjectId | 主键 | 文章唯一标识 | ObjectId("60d21b4667d0d8992e610c86") |
| title | String | 非空 | 文章标题 | "Vue3 Composition API 入门" |
| content | String | 非空 | 文章内容(Markdown) | "# 标题\n内容..." |
| authorId | ObjectId | 非空, 外键 | 作者ID(关联Users) | ObjectId("60d21b4667d0d8992e610c85") |
| category | String | 非空 | 文章分类 | "技术" |
| tags | [String] | 可选 | 文章标签 | ["Vue3", "前端"] |
| coverImage | String | 可选 | 封面图片URL | "https://example.com/cover.jpg" |
| viewCount | Number | 非空, 默认0 | 阅读量 | 120 |
| likeCount | Number | 非空, 默认0 | 点赞数 | 25 |
| status | String | 非空, 默认"published" | 状态 | "published"/"draft" |
| createdAt | Date | 非空 | 创建时间 | ISODate("2023-06-20T10:00:00Z") |
| updatedAt | Date | 非空 | 更新时间 | ISODate("2023-06-20T10:00:00Z") |

**索引**：
- 外键索引：authorId
- 普通索引：category, tags, status, createdAt

### 3.3 评论表（Comments）
| 字段名 | 类型 | 约束 | 描述 | 示例 |
|--------|------|------|------|------|
| _id | ObjectId | 主键 | 评论唯一标识 | ObjectId("60d21b4667d0d8992e610c87") |
| articleId | ObjectId | 非空, 外键 | 文章ID(关联Articles) | ObjectId("60d21b4667d0d8992e610c86") |
| userId | ObjectId | 非空, 外键 | 用户ID(关联Users) | ObjectId("60d21b4667d0d8992e610c85") |
| content | String | 非空 | 评论内容 | "很棒的文章!" |
| parentId | ObjectId | 可选, 外键 | 父评论ID(用于回复功能) | ObjectId("60d21b4667d0d8992e610c88") |
| createdAt | Date | 非空 | 创建时间 | ISODate("2023-06-20T10:00:00Z") |

**索引**：
- 复合索引：(articleId, parentId)
- 外键索引：userId

### 3.4 游戏表（Games）
| 字段名 | 类型 | 约束 | 描述 | 示例 |
|--------|------|------|------|------|
| _id | ObjectId | 主键 | 游戏唯一标识 | ObjectId("60d21b4667d0d8992e610c89") |
| name | String | 非空 | 游戏名称 | "贪吃蛇" |
| description | String | 可选 | 游戏描述 | "经典贪吃蛇游戏" |
| category | String | 非空 | 游戏分类 | "休闲" |
| thumbnail | String | 可选 | 游戏缩略图URL | "https://example.com/snake.jpg" |
| url | String | 非空 | 游戏页面URL | "/games/snake.html" |
| playCount | Number | 非空, 默认0 | 游玩次数 | 350 |
| createdAt | Date | 非空 | 创建时间 | ISODate("2023-06-20T10:00:00Z") |

**索引**：
- 普通索引：category, name

### 3.5 游戏分数表（GameScores）
| 字段名 | 类型 | 约束 | 描述 | 示例 |
|--------|------|------|------|------|
| _id | ObjectId | 主键 | 分数记录ID | ObjectId("60d21b4667d0d8992e610c90") |
| gameId | ObjectId | 非空, 外键 | 游戏ID(关联Games) | ObjectId("60d21b4667d0d8992e610c89") |
| userId | ObjectId | 非空, 外键 | 用户ID(关联Users) | ObjectId("60d21b4667d0d8992e610c85") |
| score | Number | 非空 | 游戏分数 | 1500 |
| createdAt | Date | 非空 | 记录时间 | ISODate("2023-06-20T10:00:00Z") |

**索引**：
- 复合索引：(gameId, userId)
- 排序索引：(gameId, score: -1)

## 四、数据关系图
```
Users 1───┐
          ├─* Articles 1───┐
          ├─* Comments     │
          └─* GameScores   │
Games 1───┐                │
          └─* GameScores   └─* Comments
```

## 五、数据库安全策略
1. 敏感字段加密存储（如用户密码使用bcrypt加密）
2. 实现数据库访问权限控制
3. 定期数据备份（每日自动备份）
4. 防止SQL注入（使用ORM参数化查询）

## 六、性能优化建议
1. 对常用查询字段建立索引（如文章标题、分类）
2. 实现数据分页查询（默认每页20条）
3. 热门文章/游戏数据缓存（使用Redis）
4. 大文本内容（如文章）考虑分块存储