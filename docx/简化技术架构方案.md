# 简化技术架构方案

## 一、简化目标
- **降低复杂度**：减少组件数量，简化部署流程
- **易于维护**：个人项目重点关注开发效率
- **成本控制**：减少服务器资源消耗
- **快速上线**：缩短从开发到部署的时间

## 二、简化后的技术栈

### 2.1 前端技术栈（保持不变）
- **核心框架**：Vue 3 (Composition API)
- **构建工具**：Vite
- **UI组件库**：Element Plus
- **状态管理**：Pinia
- **路由管理**：Vue Router 4

### 2.2 后端技术栈（最终确定）
- **开发语言**：Node.js
- **后端框架**：Express.js
- **数据库**：MongoDB
- **缓存**：node-cache（内存缓存）
- **认证**：JWT
- **文件存储**：本地存储

### 2.3 部署方案（最终确定）
- **部署方式**：直接部署
- **Web服务器**：Node.js + Express
- **进程管理**：PM2（可选）
- **静态文件**：Express静态服务

## 三、数据存储简化

### 3.1 MongoDB方案（最终选择）
```javascript
// 安装依赖
npm install mongoose

// 数据库配置
const mongoose = require('mongoose');

mongoose.connect(process.env.MONGODB_URI, {
  useNewUrlParser: true,
  useUnifiedTopology: true
});

// 优点：
// - 文档型数据库，适合博客内容
// - 灵活的Schema设计
// - 强大的查询能力
// - 良好的扩展性
```

### 3.2 内存缓存替代Redis
```javascript
// 安装依赖
npm install node-cache

// 缓存配置
const NodeCache = require('node-cache');
const cache = new NodeCache({
  stdTTL: 600,        // 默认10分钟过期
  checkperiod: 120    // 每2分钟检查过期
});

// 使用示例
cache.set('articles:hot', hotArticles, 3600); // 1小时缓存
const cached = cache.get('articles:hot');
```

## 四、简化部署配置

### 4.1 直接部署方案
```json
// package.json 简化脚本
{
  "scripts": {
    "dev": "concurrently \"npm run dev:frontend\" \"npm run dev:backend\"",
    "dev:frontend": "cd frontend && npm run dev",
    "dev:backend": "cd backend && npm run dev",
    "build": "cd frontend && npm run build",
    "start": "cd backend && npm start",
    "deploy": "npm run build && npm start"
  }
}
```

```bash
# 生产环境部署步骤
1. 上传代码到服务器
2. npm install
3. npm run build
4. npm start

# 可选：使用PM2管理
npm install -g pm2
pm2 start backend/app.js --name "website"
pm2 startup
pm2 save
```



## 五、项目结构简化

```
personal-website/
├── frontend/                 # 前端代码
│   ├── src/
│   ├── public/
│   └── package.json
├── backend/                  # 后端代码
│   ├── src/
│   ├── uploads/             # 文件上传目录
│   └── package.json
├── data/                    # 数据目录（MongoDB数据）
├── docs/                    # 文档目录
├── .env.example             # 环境变量示例
├── deploy.sh                # 部署脚本
└── package.json             # 根目录脚本
```

## 六、监控简化

### 6.1 基础监控（可选）
```javascript
// 简单的健康检查接口
app.get('/health', (req, res) => {
  res.json({
    status: 'ok',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    memory: process.memoryUsage()
  });
});

// 简单的错误日志
const winston = require('winston');
const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' })
  ]
});
```

### 6.2 性能监控（可选）
```javascript
// 简单的性能统计
const performanceStats = {
  requests: 0,
  errors: 0,
  startTime: Date.now()
};

app.use((req, res, next) => {
  performanceStats.requests++;
  const start = Date.now();

  res.on('finish', () => {
    const duration = Date.now() - start;
    if (res.statusCode >= 400) {
      performanceStats.errors++;
    }
    console.log(`${req.method} ${req.path} - ${res.statusCode} - ${duration}ms`);
  });

  next();
});

// 统计接口
app.get('/stats', (req, res) => {
  res.json({
    ...performanceStats,
    uptime: Date.now() - performanceStats.startTime,
    errorRate: (performanceStats.errors / performanceStats.requests * 100).toFixed(2) + '%'
  });
});
```

## 七、安全简化

### 7.1 基础安全措施
```javascript
// 基础安全中间件
const helmet = require('helmet');
const rateLimit = require('express-rate-limit');

// 安全头
app.use(helmet());

// 基础限流
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15分钟
  max: 100 // 限制每个IP 100次请求
});
app.use('/api/', limiter);

// 登录限流
const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 5,
  skipSuccessfulRequests: true
});
app.use('/api/auth/login', loginLimiter);
```

### 7.2 环境变量管理
```bash
# .env 文件
NODE_ENV=production
PORT=3000
JWT_SECRET=your_super_secret_key_here
DATABASE_PATH=./data/database.sqlite
UPLOAD_PATH=./uploads
```

## 八、备份策略简化

### 8.1 数据备份
```bash
#!/bin/bash
# backup.sh - 简单备份脚本

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="./backups"

# 创建备份目录
mkdir -p $BACKUP_DIR

# 备份数据库
cp ./data/database.sqlite $BACKUP_DIR/database_$DATE.sqlite

# 备份上传文件
tar -czf $BACKUP_DIR/uploads_$DATE.tar.gz ./uploads

# 保留最近7天的备份
find $BACKUP_DIR -name "*.sqlite" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete

echo "Backup completed: $DATE"
```

### 8.2 自动备份（可选）
```bash
# 添加到crontab，每天凌晨2点备份
0 2 * * * /path/to/your/project/backup.sh
```

## 九、扩展路径

当项目规模增长时，可以逐步扩展：

### 9.1 数据库扩展
```
MongoDB → MongoDB + Redis → MongoDB集群
```

### 9.2 部署扩展
```
直接部署 → PM2 → Docker → Nginx + PM2 → Kubernetes
```

### 9.3 监控扩展
```
基础日志 → Winston → 性能监控 → 完整监控栈
```

## 十、最终推荐方案

### 10.1 当前确定方案
- **数据库**：MongoDB
- **缓存**：node-cache（内存缓存）
- **部署**：直接部署 + PM2（可选）
- **日志**：基础日志记录

### 10.2 快速开始
```bash
# 1. 克隆项目
git clone your-repo
cd personal-website

# 2. 配置环境
cp rules/.env.example .env
# 编辑 .env 文件

# 3. 一键部署
chmod +x rules/deploy.sh
./rules/deploy.sh
```

这个简化方案可以让您快速启动项目，后期根据实际需求再逐步扩展功能。
