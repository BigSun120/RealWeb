# 代码规范文档

## 一、文档概述
- **文档版本**：1.0
- **适用范围**：个人网站项目开发团队
- **规范目标**：统一代码风格、提高代码质量、便于团队协作

## 二、通用编码规范

### 2.1 命名规范
- **变量名**：使用camelCase（驼峰命名）
  ```javascript
  // 正确
  const userName = 'john';
  const isLoggedIn = true;
  
  // 错误
  const user_name = 'john';
  const IsLoggedIn = true;
  ```

- **常量名**：使用UPPER_SNAKE_CASE
  ```javascript
  // 正确
  const API_BASE_URL = 'https://api.example.com';
  const MAX_FILE_SIZE = 1024 * 1024;
  
  // 错误
  const apiBaseUrl = 'https://api.example.com';
  ```

- **函数名**：使用camelCase，动词开头
  ```javascript
  // 正确
  function getUserInfo() {}
  function validateEmail() {}
  
  // 错误
  function userInfo() {}
  function email() {}
  ```

- **类名**：使用PascalCase
  ```javascript
  // 正确
  class UserService {}
  class ArticleController {}
  
  // 错误
  class userService {}
  class articleController {}
  ```

### 2.2 文件命名规范
- **组件文件**：PascalCase
  ```
  UserProfile.vue
  ArticleList.vue
  GameCard.vue
  ```

- **工具文件**：camelCase
  ```
  apiClient.js
  dateUtils.js
  validation.js
  ```

- **配置文件**：kebab-case
  ```
  webpack.config.js
  eslint.config.js
  docker-compose.yml
  ```

## 三、JavaScript/Node.js规范

### 3.1 代码格式化
```javascript
// ESLint + Prettier 配置
module.exports = {
  env: {
    browser: true,
    es2021: true,
    node: true
  },
  extends: [
    'eslint:recommended',
    '@vue/typescript/recommended',
    'prettier'
  ],
  rules: {
    // 缩进：2个空格
    'indent': ['error', 2],
    
    // 引号：单引号
    'quotes': ['error', 'single'],
    
    // 分号：必须使用
    'semi': ['error', 'always'],
    
    // 行尾逗号
    'comma-dangle': ['error', 'never'],
    
    // 最大行长度
    'max-len': ['error', { code: 100 }]
  }
};
```

### 3.2 变量声明
```javascript
// 正确：使用const/let，避免var
const config = require('./config');
let userCount = 0;

// 错误：使用var
var config = require('./config');

// 正确：一行一个变量
const name = 'John';
const age = 25;

// 错误：多个变量一行
const name = 'John', age = 25;
```

### 3.3 函数定义
```javascript
// 正确：箭头函数用于简单表达式
const add = (a, b) => a + b;
const users = data.map(item => item.user);

// 正确：普通函数用于复杂逻辑
function validateUser(user) {
  if (!user.email) {
    throw new Error('Email is required');
  }
  
  if (!user.password) {
    throw new Error('Password is required');
  }
  
  return true;
}

// 正确：async/await处理异步
async function fetchUserData(userId) {
  try {
    const response = await api.get(`/users/${userId}`);
    return response.data;
  } catch (error) {
    logger.error('Failed to fetch user data:', error);
    throw error;
  }
}
```

### 3.4 错误处理
```javascript
// 正确：统一错误处理
class ApiError extends Error {
  constructor(message, statusCode = 500) {
    super(message);
    this.statusCode = statusCode;
    this.name = 'ApiError';
  }
}

// 正确：使用try-catch
async function createUser(userData) {
  try {
    const user = await User.create(userData);
    return user;
  } catch (error) {
    if (error.code === 11000) {
      throw new ApiError('用户已存在', 400);
    }
    throw new ApiError('创建用户失败', 500);
  }
}

// 正确：Promise错误处理
fetchData()
  .then(data => processData(data))
  .catch(error => {
    logger.error('Data processing failed:', error);
    return defaultData;
  });
```

## 四、Vue.js规范

### 4.1 组件结构
```vue
<template>
  <!-- 模板内容 -->
  <div class="user-profile">
    <h1>{{ user.name }}</h1>
    <p>{{ user.email }}</p>
  </div>
</template>

<script>
import { defineComponent, ref, onMounted } from 'vue';
import { useUserStore } from '@/stores/user';

export default defineComponent({
  name: 'UserProfile',
  
  props: {
    userId: {
      type: String,
      required: true
    }
  },
  
  emits: ['update', 'delete'],
  
  setup(props, { emit }) {
    const userStore = useUserStore();
    const user = ref(null);
    
    const loadUser = async () => {
      try {
        user.value = await userStore.fetchUser(props.userId);
      } catch (error) {
        console.error('Failed to load user:', error);
      }
    };
    
    onMounted(() => {
      loadUser();
    });
    
    return {
      user,
      loadUser
    };
  }
});
</script>

<style scoped>
.user-profile {
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 8px;
}
</style>
```

### 4.2 组件命名
```javascript
// 正确：多词组件名
export default {
  name: 'UserProfile'
};

// 错误：单词组件名
export default {
  name: 'User'
};

// 正确：组件注册
import UserProfile from './UserProfile.vue';
import ArticleList from './ArticleList.vue';

export default {
  components: {
    UserProfile,
    ArticleList
  }
};
```

### 4.3 Props定义
```javascript
// 正确：详细的props定义
props: {
  title: {
    type: String,
    required: true,
    validator: value => value.length > 0
  },
  
  items: {
    type: Array,
    default: () => []
  },
  
  config: {
    type: Object,
    default: () => ({
      showHeader: true,
      pageSize: 10
    })
  }
}

// 错误：简单类型定义
props: ['title', 'items', 'config']
```

## 五、CSS/SCSS规范

### 5.1 选择器命名
```scss
// 正确：BEM命名法
.article-card {
  padding: 16px;
  
  &__header {
    margin-bottom: 12px;
  }
  
  &__title {
    font-size: 18px;
    font-weight: bold;
  }
  
  &__content {
    line-height: 1.6;
  }
  
  &--featured {
    border: 2px solid #007bff;
  }
}

// 错误：嵌套过深
.article {
  .header {
    .title {
      .text {
        color: #333;
      }
    }
  }
}
```

### 5.2 样式组织
```scss
// 变量定义
$primary-color: #007bff;
$secondary-color: #6c757d;
$border-radius: 4px;
$spacing-unit: 8px;

// Mixin定义
@mixin button-style($bg-color, $text-color: white) {
  background-color: $bg-color;
  color: $text-color;
  border: none;
  border-radius: $border-radius;
  padding: $spacing-unit * 2 $spacing-unit * 3;
  cursor: pointer;
  
  &:hover {
    opacity: 0.8;
  }
}

// 组件样式
.btn {
  @include button-style($primary-color);
  
  &--secondary {
    @include button-style($secondary-color);
  }
}
```

## 六、注释规范

### 6.1 JavaScript注释
```javascript
/**
 * 用户服务类
 * 提供用户相关的业务逻辑处理
 */
class UserService {
  /**
   * 创建新用户
   * @param {Object} userData - 用户数据
   * @param {string} userData.email - 用户邮箱
   * @param {string} userData.password - 用户密码
   * @returns {Promise<Object>} 创建的用户对象
   * @throws {ApiError} 当邮箱已存在时抛出错误
   */
  async createUser(userData) {
    // 验证邮箱格式
    if (!this.isValidEmail(userData.email)) {
      throw new ApiError('邮箱格式不正确', 400);
    }
    
    // 检查邮箱是否已存在
    const existingUser = await User.findOne({ email: userData.email });
    if (existingUser) {
      throw new ApiError('邮箱已存在', 400);
    }
    
    // 创建用户
    return await User.create(userData);
  }
}
```

### 6.2 Vue组件注释
```vue
<template>
  <!-- 用户列表容器 -->
  <div class="user-list">
    <!-- 搜索框 -->
    <div class="search-box">
      <input 
        v-model="searchQuery" 
        placeholder="搜索用户..."
        @input="handleSearch"
      />
    </div>
    
    <!-- 用户卡片列表 -->
    <div class="user-cards">
      <UserCard 
        v-for="user in filteredUsers" 
        :key="user.id"
        :user="user"
        @click="handleUserClick"
      />
    </div>
  </div>
</template>

<script>
/**
 * 用户列表组件
 * 显示用户列表，支持搜索和筛选功能
 */
export default {
  name: 'UserList',
  
  // 组件属性
  props: {
    // 初始用户列表
    users: {
      type: Array,
      default: () => []
    }
  }
};
</script>
```

## 七、Git提交规范

### 7.1 提交信息格式
```bash
# 格式：<type>(<scope>): <subject>

# 功能开发
feat(auth): 添加用户登录功能
feat(blog): 实现文章发布功能

# Bug修复
fix(api): 修复用户注册接口错误
fix(ui): 修复移动端样式问题

# 文档更新
docs(readme): 更新项目安装说明
docs(api): 完善接口文档

# 样式调整
style(header): 调整导航栏样式
style(button): 统一按钮颜色

# 重构
refactor(user): 重构用户服务代码
refactor(db): 优化数据库查询逻辑

# 测试
test(auth): 添加登录功能测试用例
test(api): 完善接口测试覆盖

# 构建
build(webpack): 更新webpack配置
build(docker): 优化Docker镜像构建
```

### 7.2 分支管理
```bash
# 主分支
main          # 生产环境代码
develop       # 开发环境代码

# 功能分支
feature/user-auth        # 用户认证功能
feature/blog-system      # 博客系统功能
feature/game-integration # 游戏集成功能

# 修复分支
hotfix/login-bug         # 紧急修复登录问题
hotfix/security-patch    # 安全补丁

# 发布分支
release/v1.0.0          # 版本发布准备
```

## 八、代码质量检查

### 8.1 ESLint配置
```javascript
// .eslintrc.js
module.exports = {
  root: true,
  env: {
    node: true,
    browser: true,
    es2021: true
  },
  extends: [
    'eslint:recommended',
    '@vue/typescript/recommended',
    'prettier'
  ],
  parserOptions: {
    ecmaVersion: 2021,
    sourceType: 'module'
  },
  rules: {
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-unused-vars': 'error',
    'no-undef': 'error',
    'prefer-const': 'error',
    'no-var': 'error'
  }
};
```

### 8.2 Prettier配置
```javascript
// .prettierrc.js
module.exports = {
  semi: true,
  singleQuote: true,
  tabWidth: 2,
  trailingComma: 'none',
  printWidth: 100,
  bracketSpacing: true,
  arrowParens: 'avoid'
};
```

### 8.3 Husky Git Hooks
```json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
    }
  },
  "lint-staged": {
    "*.{js,vue,ts}": [
      "eslint --fix",
      "prettier --write",
      "git add"
    ],
    "*.{css,scss,less}": [
      "stylelint --fix",
      "prettier --write",
      "git add"
    ]
  }
}
```

## 九、性能优化规范

### 9.1 代码分割
```javascript
// 路由懒加载
const routes = [
  {
    path: '/user',
    component: () => import('@/views/User.vue')
  },
  {
    path: '/blog',
    component: () => import('@/views/Blog.vue')
  }
];

// 组件懒加载
export default {
  components: {
    UserProfile: () => import('@/components/UserProfile.vue')
  }
};
```

### 9.2 API优化
```javascript
// 正确：使用分页
async function getArticles(page = 1, limit = 10) {
  const skip = (page - 1) * limit;
  return await Article.find()
    .skip(skip)
    .limit(limit)
    .sort({ createdAt: -1 });
}

// 正确：字段选择
async function getUserProfile(userId) {
  return await User.findById(userId)
    .select('username email avatar bio createdAt');
}
```

## 十、测试规范

### 10.1 单元测试
```javascript
// 测试文件命名：*.test.js 或 *.spec.js
describe('UserService', () => {
  describe('createUser', () => {
    it('应该成功创建用户', async () => {
      const userData = {
        username: 'testuser',
        email: 'test@example.com',
        password: 'Password123!'
      };
      
      const user = await userService.createUser(userData);
      
      expect(user).toBeDefined();
      expect(user.email).toBe(userData.email);
    });
    
    it('应该拒绝重复邮箱', async () => {
      const userData = {
        email: 'existing@example.com'
      };
      
      await expect(userService.createUser(userData))
        .rejects
        .toThrow('邮箱已存在');
    });
  });
});
```

### 10.2 测试覆盖率要求
- **单元测试覆盖率**：≥ 80%
- **集成测试覆盖率**：≥ 60%
- **关键业务逻辑**：100%覆盖
