# 技术架构设计文档

## 一、文档概述
- **文档版本**：1.0
- **适用范围**：个人网站项目开发团队
- **设计目标**：明确技术选型、架构设计和部署方案

## 二、技术栈确定

### 2.1 前端技术栈（确定）
- **核心框架**：Vue 3 (Composition API)
- **构建工具**：Vite
- **UI组件库**：Element Plus
- **状态管理**：Pinia
- **路由管理**：Vue Router 4
- **HTTP客户端**：Axios
- **CSS预处理器**：SCSS

### 2.2 后端技术栈（确定）
- **开发语言**：Node.js
- **后端框架**：Express.js
- **数据库**：MongoDB
- **缓存系统**：内存缓存（node-cache）
- **认证机制**：JWT
- **API文档**：Swagger
- **文件存储**：本地存储

## 三、系统架构设计

### 3.1 整体架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端 (Vue3)   │────│   后端 (Node)   │────│  数据库 (Mongo) │
│   Port: 3000    │    │   Port: 8000    │    │   Port: 27017   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │
                       ┌─────────────────┐
                       │  内存缓存       │
                       │  (node-cache)   │
                       └─────────────────┘
```

### 3.2 服务器架构
- **开发环境**：本地开发服务器
- **生产环境**：
  - 应用服务器：Node.js（直接运行或PM2管理）
  - 数据库：MongoDB（本地或云数据库）
  - 静态文件：Express静态服务

### 3.3 网络架构
```
Internet
    │
┌───▼────┐
│Node.js │ (8000端口)
│Express │ 静态文件服务
└───┬────┘
    │
┌───▼────┐
│MongoDB │ (27017端口)
└────────┘
```

## 四、开发环境配置

### 4.1 本地开发环境
```bash
# 前端开发环境
cd frontend
npm install
npm run dev  # 启动开发服务器 (http://localhost:3000)

# 后端开发环境
cd backend
npm install
npm run dev  # 启动API服务器 (http://localhost:8000)

# MongoDB数据库
# 本地安装MongoDB或使用MongoDB Atlas云服务
```

### 4.2 环境变量配置
```bash
# .env.development
NODE_ENV=development
PORT=8000
MONGODB_URI=mongodb://localhost:27017/personal_website_dev
JWT_SECRET=your_jwt_secret_key_here
UPLOAD_PATH=./uploads

# .env.production
NODE_ENV=production
PORT=8000
MONGODB_URI=mongodb://localhost:27017/personal_website_prod
JWT_SECRET=your_super_secure_jwt_secret_key
UPLOAD_PATH=./uploads
```

## 五、API设计规范

### 5.1 RESTful API规范
- **URL命名**：使用小写字母和连字符
- **HTTP方法**：
  - GET：获取资源
  - POST：创建资源
  - PUT：更新整个资源
  - PATCH：部分更新资源
  - DELETE：删除资源

### 5.2 响应格式标准
```javascript
// 成功响应
{
  "code": 200,
  "message": "success",
  "data": { ... },
  "timestamp": "2023-06-20T10:00:00Z"
}

// 错误响应
{
  "code": 400,
  "message": "请求参数错误",
  "errors": [
    {
      "field": "email",
      "message": "邮箱格式不正确"
    }
  ],
  "timestamp": "2023-06-20T10:00:00Z"
}
```

### 5.3 状态码规范
- **2xx 成功**：200 OK, 201 Created, 204 No Content
- **4xx 客户端错误**：400 Bad Request, 401 Unauthorized, 403 Forbidden, 404 Not Found
- **5xx 服务器错误**：500 Internal Server Error, 502 Bad Gateway, 503 Service Unavailable

## 六、数据库设计规范

### 6.1 MongoDB集合命名
- 使用复数形式：users, articles, comments
- 使用小写字母和下划线：game_scores
- 避免使用保留字

### 6.2 索引策略
```javascript
// 用户集合索引
db.users.createIndex({ "email": 1 }, { unique: true })
db.users.createIndex({ "username": 1 }, { unique: true })

// 文章集合索引
db.articles.createIndex({ "authorId": 1 })
db.articles.createIndex({ "category": 1, "createdAt": -1 })
db.articles.createIndex({ "tags": 1 })

// 评论集合索引
db.comments.createIndex({ "articleId": 1, "createdAt": -1 })
```

## 七、缓存策略

### 7.1 内存缓存设计
```javascript
const NodeCache = require('node-cache');

// 缓存配置
const cache = new NodeCache({
  stdTTL: 600,        // 默认10分钟过期
  checkperiod: 120    // 每2分钟检查过期
});

// 缓存使用示例
cache.set('articles:hot', hotArticles, 3600);     // 热门文章1小时
cache.set('articles:page:1', pageData, 600);      // 文章列表10分钟
cache.set('game:ranking', rankings, 300);         // 游戏排行5分钟
```

### 7.2 缓存更新策略
- **写入时更新**：创建/更新文章时清除相关缓存
- **定时更新**：热门数据定期刷新
- **内存管理**：设置合理的TTL避免内存溢出

## 八、安全架构

### 8.1 认证授权
- **JWT Token**：有效期24小时，自动续期
- **Refresh Token**：有效期7天，用于刷新访问令牌
- **权限控制**：基于角色的访问控制(RBAC)

### 8.2 数据安全
- **密码加密**：bcrypt算法，salt轮数12
- **敏感数据**：AES-256加密存储
- **传输安全**：HTTPS + TLS 1.2+

## 九、性能优化

### 9.1 前端优化
- **代码分割**：路由级别的懒加载
- **资源压缩**：Gzip压缩，图片WebP格式
- **CDN加速**：静态资源使用CDN分发

### 9.2 后端优化
- **连接池**：MongoDB连接池大小10-50
- **查询优化**：使用索引，避免全表扫描
- **响应压缩**：启用gzip压缩

## 十、日志管理

### 10.1 基础日志
```javascript
// 使用Winston进行日志记录
const winston = require('winston');

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'logs/error.log', level: 'error' }),
    new winston.transports.File({ filename: 'logs/combined.log' }),
    new winston.transports.Console()
  ]
});
```

## 十一、部署方案

### 11.1 生产环境部署
```bash
# 1. 服务器准备
# 安装Node.js 16+
# 安装MongoDB

# 2. 代码部署
git clone your-repo
cd personal-website
npm run setup

# 3. 构建前端
npm run build

# 4. 启动服务
npm start

# 5. 可选：使用PM2管理进程
npm install -g pm2
pm2 start backend/app.js --name website
pm2 startup
pm2 save
```

### 11.2 生产环境配置
- **进程管理**：PM2或直接运行
- **自动重启**：PM2进程异常时自动重启
- **静态文件**：Express serve static files
- **数据备份**：定期备份MongoDB数据
