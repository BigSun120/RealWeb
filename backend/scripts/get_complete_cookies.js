/**
 * å®Œæ•´çš„YouTube Cookiesè·å–è„šæœ¬
 * åœ¨YouTubeé¡µé¢çš„æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œ
 * è·å–æ›´å®Œæ•´çš„è®¤è¯cookies
 */

// å®Œæ•´ç‰ˆcookiesæå–è„šæœ¬
(function() {
    console.log('ğŸª å®Œæ•´ç‰ˆYouTube Cookiesæå–å·¥å…·');
    console.log('ğŸ“‹ ä½¿ç”¨è¯´æ˜ï¼š');
    console.log('1. ç¡®ä¿å·²ç™»å½•YouTubeè´¦æˆ·');
    console.log('2. è§‚çœ‹å‡ ä¸ªè§†é¢‘ï¼Œè¿›è¡Œä¸€äº›æ“ä½œ');
    console.log('3. è¿è¡Œæ­¤è„šæœ¬');
    console.log('');
    
    window.getCompleteYouTubeCookies = function() {
        console.log('ğŸ” å¼€å§‹æ‰«ææ‰€æœ‰cookies...');
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        const isLoggedIn = document.cookie.includes('SAPISID') || 
                          document.cookie.includes('__Secure-3PSID') ||
                          document.cookie.includes('LOGIN_INFO');
        
        if (!isLoggedIn) {
            console.log('âŒ æ£€æµ‹åˆ°æœªç™»å½•çŠ¶æ€');
            console.log('ğŸ’¡ è¯·å…ˆç™»å½•YouTubeè´¦æˆ·ï¼Œç„¶åé‡æ–°è¿è¡Œè„šæœ¬');
            return null;
        }
        
        console.log('âœ… æ£€æµ‹åˆ°å·²ç™»å½•çŠ¶æ€');
        
        // è·å–æ‰€æœ‰cookies
        const allCookies = document.cookie.split(';');
        
        // æ‰€æœ‰é‡è¦çš„YouTubeå’ŒGoogle cookies
        const importantCookies = [
            // åŸºç¡€è®¤è¯
            'VISITOR_INFO1_LIVE',
            'YSC',
            'PREF',
            'CONSENT',
            'SOCS',
            
            // å®‰å…¨è®¤è¯
            '__Secure-3PSID',
            '__Secure-3PAPISID',
            '__Secure-3PSIDCC',
            '__Secure-1PSID',
            '__Secure-1PAPISID',
            '__Secure-1PSIDCC',
            
            // ä¼šè¯è®¤è¯
            'HSID',
            'SSID',
            'APISID',
            'SAPISID',
            'SID',
            'SIDCC',
            
            // ç™»å½•ä¿¡æ¯
            'LOGIN_INFO',
            'SESSION_TOKEN',
            
            // YouTubeç‰¹å®š
            '__Secure-YT_TVFAS',
            '__Secure-ROLLOUT_TOKEN',
            'DEVICE_INFO',
            'VISITOR_PRIVACY_METADATA',
            '__Secure-YT_DERP',
            
            // å…¶ä»–é‡è¦
            'NID',
            'DV',
            '1P_JAR'
        ];
        
        let cookiesText = '# Netscape HTTP Cookie File\n';
        cookiesText += '# This file is generated by YouTube cookies extractor\n';
        cookiesText += '# Generated on: ' + new Date().toISOString() + '\n\n';
        
        let foundCookies = 0;
        let foundImportant = 0;
        
        allCookies.forEach(cookie => {
            const [name, value] = cookie.trim().split('=');
            if (name && value) {
                const isImportant = importantCookies.some(important => 
                    name.includes(important) || important.includes(name)
                );
                
                if (isImportant) {
                    // ç¡®å®šåŸŸå
                    let domain = '.google.com';
                    if (name.includes('YT') || name.includes('VISITOR') || name.includes('YSC')) {
                        domain = '.youtube.com';
                    }
                    
                    const flag = 'TRUE';
                    const path = '/';
                    const secure = name.includes('Secure') ? 'TRUE' : 'FALSE';
                    const expiration = Math.floor(Date.now() / 1000) + (365 * 24 * 60 * 60); // 1å¹´åè¿‡æœŸ
                    
                    cookiesText += `${domain}\t${flag}\t${path}\t${secure}\t${expiration}\t${name}\t${value}\n`;
                    foundImportant++;
                }
                foundCookies++;
            }
        });
        
        console.log(`ğŸ“Š æ‰«æç»“æœï¼š`);
        console.log(`   æ€»cookiesæ•°é‡: ${foundCookies}`);
        console.log(`   é‡è¦cookiesæ•°é‡: ${foundImportant}`);
        
        if (foundImportant < 5) {
            console.log('âš ï¸ é‡è¦cookiesæ•°é‡è¾ƒå°‘ï¼Œå»ºè®®ï¼š');
            console.log('1. è§‚çœ‹å‡ ä¸ªYouTubeè§†é¢‘');
            console.log('2. ç‚¹å‡»ä¸€äº›é¢‘é“å’Œæ’­æ”¾åˆ—è¡¨');
            console.log('3. è¿›è¡Œæœç´¢æ“ä½œ');
            console.log('4. é‡æ–°è¿è¡Œæ­¤è„šæœ¬');
            console.log('');
        }
        
        console.log('ğŸ“‹ Cookieså†…å®¹ï¼š');
        console.log('='.repeat(80));
        console.log(cookiesText);
        console.log('='.repeat(80));
        
        // è‡ªåŠ¨ä¸‹è½½
        try {
            const blob = new Blob([cookiesText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'youtube_cookies_complete.txt';
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            console.log('ğŸ’¾ å®Œæ•´cookiesæ–‡ä»¶å·²ä¸‹è½½ï¼');
        } catch (error) {
            console.log('âš ï¸ è‡ªåŠ¨ä¸‹è½½å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä¸Šé¢çš„å†…å®¹');
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        try {
            navigator.clipboard.writeText(cookiesText).then(() => {
                console.log('ğŸ“‹ Cookieså·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(() => {
                console.log('âš ï¸ æ— æ³•å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        } catch (error) {
            console.log('âš ï¸ å‰ªè´´æ¿ä¸å¯ç”¨ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
        }
        
        // æä¾›ä½¿ç”¨å»ºè®®
        console.log('');
        console.log('ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œï¼š');
        console.log('1. å°†cookieså†…å®¹ç²˜è´´åˆ°è§†é¢‘ä¸‹è½½å™¨');
        console.log('2. ç­‰å¾…1-2åˆ†é’Ÿåå†æµ‹è¯•ï¼ˆé¿å…é¢‘ç‡é™åˆ¶ï¼‰');
        console.log('3. å¦‚æœä»ç„¶å¤±è´¥ï¼Œå¯èƒ½éœ€è¦æ›´æ¢IPæˆ–ç­‰å¾…æ›´é•¿æ—¶é—´');
        
        return cookiesText;
    };
    
    console.log('ğŸš€ è„šæœ¬å·²åŠ è½½ï¼è¿è¡Œå‘½ä»¤: getCompleteYouTubeCookies()');
})();
