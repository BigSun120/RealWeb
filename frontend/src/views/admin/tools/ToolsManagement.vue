<template>
  <div class="tools-management">
    <!-- È°µÈù¢Â§¥ÈÉ® -->
    <div class="page-header">
      <div class="header-content">
        <h1 class="page-title">
          <el-icon><Tools /></el-icon>
          Â∑•ÂÖ∑ÁÆ°ÁêÜ
        </h1>
        <p class="page-description">ÁÆ°ÁêÜÂ∑•ÂÖ∑ÁöÑÂ¢ûÂà†ÊîπÊü•ÂíåÈÖçÁΩÆ</p>
      </div>
      <div class="header-actions">
        <el-button type="primary" @click="showCreateDialog">
          <el-icon><Plus /></el-icon>
          Êñ∞Â¢ûÂ∑•ÂÖ∑
        </el-button>
        <el-button @click="refreshData">
          <el-icon><Refresh /></el-icon>
          Âà∑Êñ∞
        </el-button>
      </div>
    </div>

    <!-- ÊêúÁ¥¢ÂíåÁ≠õÈÄâ -->
    <el-card class="filter-card">
      <el-form :model="filterForm" inline>
        <el-form-item label="ÊêúÁ¥¢">
          <el-input
            v-model="filterForm.search"
            placeholder="ÊêúÁ¥¢Â∑•ÂÖ∑ÂêçÁß∞„ÄÅÊèèËø∞ÊàñÊ†áÁ≠æ"
            clearable
            style="width: 250px"
            @input="handleSearch"
          >
            <template #prefix>
              <el-icon><Search /></el-icon>
            </template>
          </el-input>
        </el-form-item>
        <el-form-item label="ÂàÜÁ±ª">
          <el-select
            v-model="filterForm.category"
            placeholder="ÈÄâÊã©ÂàÜÁ±ª"
            clearable
            style="width: 150px"
            @change="handleFilter"
          >
            <el-option
              v-for="category in categories"
              :key="category.id"
              :label="category.name"
              :value="category.id"
            />
          </el-select>
        </el-form-item>
        <el-form-item label="Áä∂ÊÄÅ">
          <el-select
            v-model="filterForm.status"
            placeholder="ÈÄâÊã©Áä∂ÊÄÅ"
            clearable
            style="width: 120px"
            @change="handleFilter"
          >
            <el-option label="Ê¥ªË∑É" value="active" />
            <el-option label="Âç≥Â∞Ü‰∏äÁ∫ø" value="coming-soon" />
            <el-option label="Áª¥Êä§‰∏≠" value="maintenance" />
            <el-option label="Â∑≤‰∏ãÁ∫ø" value="inactive" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button @click="resetFilter">ÈáçÁΩÆ</el-button>
        </el-form-item>
      </el-form>
    </el-card>

    <!-- ÊâπÈáèÊìç‰Ωú -->
    <div v-if="selectedTools.length > 0" class="batch-actions">
      <el-alert
        :title="`Â∑≤ÈÄâÊã© ${selectedTools.length} ‰∏™Â∑•ÂÖ∑`"
        type="info"
        show-icon
        :closable="false"
      >
        <template #default>
          <div class="batch-buttons">
            <el-button size="small" @click="batchUpdateStatus('active')"> ÊâπÈáèÂêØÁî® </el-button>
            <el-button size="small" @click="batchUpdateStatus('inactive')"> ÊâπÈáèÁ¶ÅÁî® </el-button>
            <el-button size="small" type="danger" @click="batchDelete"> ÊâπÈáèÂà†Èô§ </el-button>
          </div>
        </template>
      </el-alert>
    </div>

    <!-- Â∑•ÂÖ∑ÂàóË°® -->
    <el-card class="table-card">
      <el-table v-loading="loading" :data="tools" @selection-change="handleSelectionChange" stripe>
        <el-table-column type="selection" width="55" />
        <el-table-column label="Â∑•ÂÖ∑‰ø°ÊÅØ" min-width="200">
          <template #default="{ row }">
            <div class="tool-info">
              <div class="tool-icon">{{ row.icon }}</div>
              <div class="tool-details">
                <div class="tool-name">{{ row.name }}</div>
                <div class="tool-description">{{ row.description }}</div>
              </div>
            </div>
          </template>
        </el-table-column>
        <el-table-column label="ÂàÜÁ±ª" width="120">
          <template #default="{ row }">
            <el-tag size="small">{{ getCategoryName(row.category) }}</el-tag>
          </template>
        </el-table-column>
        <el-table-column label="Áä∂ÊÄÅ" width="100">
          <template #default="{ row }">
            <el-tag :type="getStatusType(row.status)" size="small">
              {{ getStatusText(row.status) }}
            </el-tag>
          </template>
        </el-table-column>
        <el-table-column label="Êé®Ëçê" width="80">
          <template #default="{ row }">
            <el-icon v-if="row.featured" color="#E6A23C">
              <Star />
            </el-icon>
          </template>
        </el-table-column>
        <el-table-column label="‰ΩøÁî®Ê¨°Êï∞" width="100" sortable>
          <template #default="{ row }">
            {{ row.usageCount || 0 }}
          </template>
        </el-table-column>
        <el-table-column label="ÂàõÂª∫Êó∂Èó¥" width="160">
          <template #default="{ row }">
            {{ formatDate(row.createdAt) }}
          </template>
        </el-table-column>
        <el-table-column label="Êìç‰Ωú" width="200" fixed="right">
          <template #default="{ row }">
            <el-button size="small" @click="editTool(row)"> ÁºñËæë </el-button>
            <el-button
              size="small"
              :type="row.status === 'active' ? 'warning' : 'success'"
              @click="toggleStatus(row)"
            >
              {{ row.status === 'active' ? 'Á¶ÅÁî®' : 'ÂêØÁî®' }}
            </el-button>
            <el-button size="small" type="danger" @click="deleteTool(row)"> Âà†Èô§ </el-button>
          </template>
        </el-table-column>
      </el-table>

      <!-- ÂàÜÈ°µ -->
      <div class="pagination-wrapper">
        <el-pagination
          :current-page="pagination.page"
          :page-size="pagination.limit"
          :total="pagination.total"
          :page-sizes="[10, 20, 50, 100]"
          layout="total, sizes, prev, pager, next, jumper"
          @size-change="handleSizeChange"
          @current-change="handlePageChange"
        />
      </div>
    </el-card>

    <!-- ÂàõÂª∫/ÁºñËæëÂ∑•ÂÖ∑ÂØπËØùÊ°Ü -->
    <el-dialog
      v-model="dialogVisible"
      :title="isEdit ? 'ÁºñËæëÂ∑•ÂÖ∑' : 'Êñ∞Â¢ûÂ∑•ÂÖ∑'"
      width="800px"
      @close="resetForm"
    >
      <el-form ref="formRef" :model="form" :rules="formRules" label-width="100px">
        <el-row :gutter="20">
          <el-col :span="12">
            <el-form-item label="Â∑•ÂÖ∑ID" prop="id">
              <el-input v-model="form.id" :disabled="isEdit" placeholder="ÂîØ‰∏ÄÊ†áËØÜÁ¨¶" />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="Â∑•ÂÖ∑ÂêçÁß∞" prop="name">
              <el-input v-model="form.name" placeholder="Â∑•ÂÖ∑ÂêçÁß∞" />
            </el-form-item>
          </el-col>
        </el-row>

        <el-form-item label="Â∑•ÂÖ∑ÊèèËø∞" prop="description">
          <el-input
            v-model="form.description"
            type="textarea"
            :rows="3"
            placeholder="Â∑•ÂÖ∑ÂäüËÉΩÊèèËø∞"
          />
        </el-form-item>

        <el-row :gutter="20">
          <el-col :span="8">
            <el-form-item label="ÂõæÊ†á" prop="icon">
              <el-input v-model="form.icon" placeholder="üîß" />
            </el-form-item>
          </el-col>
          <el-col :span="8">
            <el-form-item label="ÂàÜÁ±ª" prop="category">
              <el-select v-model="form.category" placeholder="ÈÄâÊã©ÂàÜÁ±ª">
                <el-option
                  v-for="category in categories"
                  :key="category.id"
                  :label="category.name"
                  :value="category.id"
                />
              </el-select>
            </el-form-item>
          </el-col>
          <el-col :span="8">
            <el-form-item label="Áä∂ÊÄÅ" prop="status">
              <el-select v-model="form.status" placeholder="ÈÄâÊã©Áä∂ÊÄÅ">
                <el-option label="Ê¥ªË∑É" value="active" />
                <el-option label="Âç≥Â∞Ü‰∏äÁ∫ø" value="coming-soon" />
                <el-option label="Áª¥Êä§‰∏≠" value="maintenance" />
                <el-option label="Â∑≤‰∏ãÁ∫ø" value="inactive" />
              </el-select>
            </el-form-item>
          </el-col>
        </el-row>

        <el-row :gutter="20">
          <el-col :span="12">
            <el-form-item label="Ë∑ØÁî±Ë∑ØÂæÑ" prop="route">
              <el-input v-model="form.route" placeholder="/tools/category/tool" />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="ÁªÑ‰ª∂Ë∑ØÂæÑ" prop="component">
              <el-input v-model="form.component" placeholder="@/views/tools/..." />
            </el-form-item>
          </el-col>
        </el-row>

        <el-row :gutter="20">
          <el-col :span="8">
            <el-form-item label="ÈöæÂ∫¶">
              <el-select v-model="form.difficulty" placeholder="ÈÄâÊã©ÈöæÂ∫¶">
                <el-option label="ÁÆÄÂçï" value="easy" />
                <el-option label="‰∏≠Á≠â" value="medium" />
                <el-option label="Âõ∞Èöæ" value="hard" />
              </el-select>
            </el-form-item>
          </el-col>
          <el-col :span="8">
            <el-form-item label="È¢ÑËÆ°Êó∂Èó¥">
              <el-input v-model="form.estimatedTime" placeholder="1ÂàÜÈíü" />
            </el-form-item>
          </el-col>
          <el-col :span="8">
            <el-form-item label="ÊéíÂ∫èÊùÉÈáç">
              <el-input-number v-model="form.sortOrder" :min="0" :max="999" style="width: 100%" />
            </el-form-item>
          </el-col>
        </el-row>

        <el-form-item label="Ê†áÁ≠æ">
          <el-select
            v-model="form.tags"
            multiple
            filterable
            allow-create
            placeholder="Ê∑ªÂä†Ê†áÁ≠æ"
            style="width: 100%"
          >
            <el-option v-for="tag in commonTags" :key="tag" :label="tag" :value="tag" />
          </el-select>
        </el-form-item>

        <el-row :gutter="20">
          <el-col :span="12">
            <el-form-item>
              <el-checkbox v-model="form.featured">Êé®ËçêÂ∑•ÂÖ∑</el-checkbox>
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item>
              <el-checkbox v-model="form.requiresAuth">ÈúÄË¶ÅÁôªÂΩï</el-checkbox>
            </el-form-item>
          </el-col>
        </el-row>
      </el-form>

      <template #footer>
        <el-button @click="dialogVisible = false">ÂèñÊ∂à</el-button>
        <el-button type="primary" @click="submitForm" :loading="submitting">
          {{ isEdit ? 'Êõ¥Êñ∞' : 'ÂàõÂª∫' }}
        </el-button>
      </template>
    </el-dialog>
  </div>
</template>

<script>
import { ref, reactive, onMounted, computed } from 'vue';
import { useRouter } from 'vue-router';
import { Tools, Plus, Refresh, Search, Star } from '@element-plus/icons-vue';
import { ElMessage, ElMessageBox } from 'element-plus';
import { toolsAPI } from '@/api/admin/tools';
import axios from 'axios';

export default {
  name: 'ToolsManagement',
  components: {
    Tools,
    Plus,
    Refresh,
    Search,
    Star
  },
  setup() {
    const router = useRouter();
    const formRef = ref(null);

    // ÂìçÂ∫îÂºèÊï∞ÊçÆ
    const loading = ref(false);
    const submitting = ref(false);
    const dialogVisible = ref(false);
    const isEdit = ref(false);
    const selectedTools = ref([]);

    const tools = ref([]);
    const categories = ref([]);
    const commonTags = ref(['JSON', 'Ê†ºÂºèÂåñ', 'ÂõæÁâá', 'ÂéãÁº©', 'ËΩ¨Êç¢', 'ÁîüÊàê', 'ÂàÜÊûê']);

    // Á≠õÈÄâË°®Âçï
    const filterForm = reactive({
      search: '',
      category: '',
      status: ''
    });

    // ÂàÜÈ°µ
    const pagination = reactive({
      page: 1,
      limit: 20,
      total: 0
    });

    // Ë°®ÂçïÊï∞ÊçÆ
    const form = reactive({
      id: '',
      name: '',
      description: '',
      icon: 'üîß',
      category: '',
      status: 'coming-soon',
      route: '',
      component: '',
      difficulty: 'easy',
      estimatedTime: '1ÂàÜÈíü',
      sortOrder: 0,
      tags: [],
      featured: false,
      requiresAuth: false
    });

    // Ë°®ÂçïÈ™åËØÅËßÑÂàô
    const formRules = {
      id: [
        { required: true, message: 'ËØ∑ËæìÂÖ•Â∑•ÂÖ∑ID', trigger: 'blur' },
        { pattern: /^[a-z0-9-]+$/, message: 'IDÂè™ËÉΩÂåÖÂê´Â∞èÂÜôÂ≠óÊØç„ÄÅÊï∞Â≠óÂíåËøûÂ≠óÁ¨¶', trigger: 'blur' }
      ],
      name: [{ required: true, message: 'ËØ∑ËæìÂÖ•Â∑•ÂÖ∑ÂêçÁß∞', trigger: 'blur' }],
      description: [{ required: true, message: 'ËØ∑ËæìÂÖ•Â∑•ÂÖ∑ÊèèËø∞', trigger: 'blur' }],
      category: [{ required: true, message: 'ËØ∑ÈÄâÊã©ÂàÜÁ±ª', trigger: 'change' }],
      route: [{ required: true, message: 'ËØ∑ËæìÂÖ•Ë∑ØÁî±Ë∑ØÂæÑ', trigger: 'blur' }],
      component: [{ required: true, message: 'ËØ∑ËæìÂÖ•ÁªÑ‰ª∂Ë∑ØÂæÑ', trigger: 'blur' }]
    };

    // ËÆ°ÁÆóÂ±ûÊÄß
    const getCategoryName = categoryId => {
      const category = categories.value.find(c => c.id === categoryId);
      return category ? category.name : categoryId;
    };

    const getStatusType = status => {
      const statusMap = {
        active: 'success',
        'coming-soon': 'warning',
        maintenance: 'info',
        inactive: 'danger'
      };
      return statusMap[status] || 'info';
    };

    const getStatusText = status => {
      const statusMap = {
        active: 'Ê¥ªË∑É',
        'coming-soon': 'Âç≥Â∞Ü‰∏äÁ∫ø',
        maintenance: 'Áª¥Êä§‰∏≠',
        inactive: 'Â∑≤‰∏ãÁ∫ø'
      };
      return statusMap[status] || status;
    };

    const formatDate = date => {
      return new Date(date).toLocaleString();
    };

    // ÊñπÊ≥ï
    const loadTools = async () => {
      loading.value = true;
      try {
        const params = {
          page: pagination.page,
          limit: pagination.limit,
          ...filterForm
        };

        const response = await toolsAPI.getTools(params);
        tools.value = response.data.tools;
        pagination.total = response.data.pagination.total;
      } catch (error) {
        ElMessage.error('Âä†ËΩΩÂ∑•ÂÖ∑ÂàóË°®Â§±Ë¥•');
      } finally {
        loading.value = false;
      }
    };

    const loadCategories = async () => {
      try {
        const response = await axios.get('/api/tools/categories/list');
        if (response.data.code === 200) {
          categories.value = response.data.data.map(cat => ({
            id: cat.id,
            name: cat.name
          }));
        } else {
          // Â¶ÇÊûúAPIË∞ÉÁî®Â§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÂàÜÁ±ª
          categories.value = [
            { id: 'web', name: 'ÁΩëÈ°µÂ∑•ÂÖ∑' },
            { id: 'text', name: 'ÊñáÊú¨Â∑•ÂÖ∑' },
            { id: 'image', name: 'ÂõæÁâáÂ∑•ÂÖ∑' },
            { id: 'dev', name: 'ÂºÄÂèëÂ∑•ÂÖ∑' },
            { id: 'utility', name: 'ÂÆûÁî®Â∑•ÂÖ∑' },
            { id: 'media', name: 'Â™í‰ΩìÂ∑•ÂÖ∑' }
          ];
        }
      } catch (error) {
        console.warn('Âä†ËΩΩÂàÜÁ±ªÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÂàÜÁ±ª:', error);
        // Â¶ÇÊûúAPIË∞ÉÁî®Â§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÂàÜÁ±ª
        categories.value = [
          { id: 'web', name: 'ÁΩëÈ°µÂ∑•ÂÖ∑' },
          { id: 'text', name: 'ÊñáÊú¨Â∑•ÂÖ∑' },
          { id: 'image', name: 'ÂõæÁâáÂ∑•ÂÖ∑' },
          { id: 'dev', name: 'ÂºÄÂèëÂ∑•ÂÖ∑' },
          { id: 'utility', name: 'ÂÆûÁî®Â∑•ÂÖ∑' },
          { id: 'media', name: 'Â™í‰ΩìÂ∑•ÂÖ∑' }
        ];
      }
    };

    const refreshData = () => {
      loadTools();
      loadCategories();
    };

    const handleSearch = () => {
      pagination.page = 1;
      loadTools();
    };

    const handleFilter = () => {
      pagination.page = 1;
      loadTools();
    };

    const resetFilter = () => {
      Object.assign(filterForm, {
        search: '',
        category: '',
        status: ''
      });
      pagination.page = 1;
      loadTools();
    };

    const handleSelectionChange = selection => {
      selectedTools.value = selection;
    };

    const handlePageChange = page => {
      pagination.page = page;
      loadTools();
    };

    const handleSizeChange = size => {
      pagination.limit = size;
      pagination.page = 1;
      loadTools();
    };

    const showCreateDialog = () => {
      isEdit.value = false;
      dialogVisible.value = true;
      resetForm();
    };

    const editTool = tool => {
      isEdit.value = true;
      dialogVisible.value = true;
      Object.assign(form, tool);
    };

    const resetForm = () => {
      if (formRef.value) {
        formRef.value.resetFields();
      }
      Object.assign(form, {
        id: '',
        name: '',
        description: '',
        icon: 'üîß',
        category: '',
        status: 'coming-soon',
        route: '',
        component: '',
        difficulty: 'easy',
        estimatedTime: '1ÂàÜÈíü',
        sortOrder: 0,
        tags: [],
        featured: false,
        requiresAuth: false
      });
    };

    const submitForm = async () => {
      if (!formRef.value) return;
      if (submitting.value) {
        console.warn('[ToolsManagement] submit blocked: submitting in progress');
        return;
      }

      try {
        submitting.value = true;
        console.group('[ToolsManagement] submitForm');
        console.log('action:', isEdit.value ? 'update' : 'create');
        console.log('raw form(before validate):', JSON.parse(JSON.stringify(form)));

        // ÂÖàËøõË°åË°®ÂçïÈ™åËØÅ
        await formRef.value.validate();
        console.log('form validation: passed');

        // Ê∏ÖÁêÜË°®ÂçïÊï∞ÊçÆÔºåÂéªÈô§Á©∫Ê†º
        const cleanForm = {
          ...form,
          id: form.id.trim(),
          name: form.name.trim(),
          description: form.description.trim(),
          route: form.route.trim(),
          component: form.component.trim(),
          icon: form.icon.trim(),
          estimatedTime: form.estimatedTime.trim()
        };
        console.log('cleanForm:', JSON.parse(JSON.stringify(cleanForm)));

        let resp;
        if (isEdit.value) {
          console.log('update id:', form._id);
          console.time('[ToolsManagement] updateTool');
          resp = await toolsAPI.updateTool(form._id, cleanForm);
          console.timeEnd('[ToolsManagement] updateTool');
          console.log('updateTool response:', resp);
          ElMessage.success('Â∑•ÂÖ∑Êõ¥Êñ∞ÊàêÂäü');
        } else {
          console.time('[ToolsManagement] createTool');
          console.log('createTool request payload:', JSON.parse(JSON.stringify(cleanForm)));
          resp = await toolsAPI.createTool(cleanForm);
          console.timeEnd('[ToolsManagement] createTool');
          console.log('createTool response:', resp);
          ElMessage.success('Â∑•ÂÖ∑ÂàõÂª∫ÊàêÂäü');
        }

        dialogVisible.value = false;
        loadTools();
      } catch (error) {
        console.error('Êèê‰∫§Ë°®ÂçïÈîôËØØ(catch):', error);
        // Áªü‰∏ÄÊâìÂç∞Êõ¥Â§öÈîôËØØ‰∏ä‰∏ãÊñá
        try {
          console.error('error.response?.status:', error?.response?.status);
          console.error('error.response?.data:', error?.response?.data);
          console.error('error.message:', error?.message);
        } catch {}

        // Â¶ÇÊûúÊòØË°®ÂçïÈ™åËØÅÈîôËØØÔºå‰∏çÊòæÁ§∫ÈîôËØØÊ∂àÊÅØ
        if (error.errors) {
          console.warn('validate errors:', error.errors);
          console.groupEnd('[ToolsManagement] submitForm');
          return;
        }

        // ÊòæÁ§∫ÂÖ∑‰ΩìÁöÑÈîôËØØ‰ø°ÊÅØ
        const errorMessage =
          error.response?.data?.message ||
          error.message ||
          (isEdit.value ? 'Êõ¥Êñ∞Â§±Ë¥•' : 'ÂàõÂª∫Â§±Ë¥•');
        ElMessage.error(errorMessage);
      } finally {
        submitting.value = false;
        console.groupEnd('[ToolsManagement] submitForm');
      }
    };

    const toggleStatus = async tool => {
      const newStatus = tool.status === 'active' ? 'inactive' : 'active';
      try {
        await toolsAPI.updateTool(tool._id, { status: newStatus });
        ElMessage.success('Áä∂ÊÄÅÊõ¥Êñ∞ÊàêÂäü');
        loadTools();
      } catch (error) {
        ElMessage.error('Áä∂ÊÄÅÊõ¥Êñ∞Â§±Ë¥•');
      }
    };

    const deleteTool = async tool => {
      try {
        await ElMessageBox.confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§Â∑•ÂÖ∑"${tool.name}"ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ`, 'Á°ÆËÆ§Âà†Èô§', {
          confirmButtonText: 'Âà†Èô§',
          cancelButtonText: 'ÂèñÊ∂à',
          type: 'warning'
        });

        await toolsAPI.deleteTool(tool._id);
        ElMessage.success('Âà†Èô§ÊàêÂäü');
        loadTools();
      } catch (error) {
        if (error !== 'cancel') {
          ElMessage.error('Âà†Èô§Â§±Ë¥•');
        }
      }
    };

    const batchUpdateStatus = async status => {
      try {
        const ids = selectedTools.value.map(tool => tool._id);
        await toolsAPI.batchUpdateStatus({ ids, status });
        ElMessage.success('ÊâπÈáèÊõ¥Êñ∞ÊàêÂäü');
        selectedTools.value = [];
        loadTools();
      } catch (error) {
        ElMessage.error('ÊâπÈáèÊõ¥Êñ∞Â§±Ë¥•');
      }
    };

    const batchDelete = async () => {
      try {
        await ElMessageBox.confirm(
          `Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${selectedTools.value.length} ‰∏™Â∑•ÂÖ∑ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ`,
          'Á°ÆËÆ§ÊâπÈáèÂà†Èô§',
          {
            confirmButtonText: 'Âà†Èô§',
            cancelButtonText: 'ÂèñÊ∂à',
            type: 'warning'
          }
        );

        const ids = selectedTools.value.map(tool => tool._id);
        await toolsAPI.batchDeleteTools(ids);
        ElMessage.success('ÊâπÈáèÂà†Èô§ÊàêÂäü');
        selectedTools.value = [];
        loadTools();
      } catch (error) {
        if (error !== 'cancel') {
          ElMessage.error('ÊâπÈáèÂà†Èô§Â§±Ë¥•');
        }
      }
    };

    onMounted(() => {
      refreshData();
    });

    return {
      // ÂìçÂ∫îÂºèÊï∞ÊçÆ
      loading,
      submitting,
      dialogVisible,
      isEdit,
      selectedTools,
      tools,
      categories,
      commonTags,
      filterForm,
      pagination,
      form,
      formRules,
      formRef,

      // ËÆ°ÁÆóÂ±ûÊÄß
      getCategoryName,
      getStatusType,
      getStatusText,
      formatDate,

      // ÊñπÊ≥ï
      refreshData,
      handleSearch,
      handleFilter,
      resetFilter,
      handleSelectionChange,
      handlePageChange,
      handleSizeChange,
      showCreateDialog,
      editTool,
      resetForm,
      submitForm,
      toggleStatus,
      deleteTool,
      batchUpdateStatus,
      batchDelete
    };
  }
};
</script>

<style scoped>
.tools-management {
  padding: 20px;
}

/* È°µÈù¢Â§¥ÈÉ® */
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 20px;
}

.page-title {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 0 0 8px 0;
  font-size: 24px;
  font-weight: 600;
  color: #303133;
}

.page-description {
  margin: 0;
  color: #606266;
  font-size: 14px;
}

.header-actions {
  display: flex;
  gap: 12px;
}

/* Á≠õÈÄâÂç°Áâá */
.filter-card {
  margin-bottom: 20px;
}

/* ÊâπÈáèÊìç‰Ωú */
.batch-actions {
  margin-bottom: 20px;
}

.batch-buttons {
  margin-top: 8px;
  display: flex;
  gap: 8px;
}

/* Ë°®Ê†ºÂç°Áâá */
.table-card {
  margin-bottom: 20px;
}

/* Â∑•ÂÖ∑‰ø°ÊÅØ */
.tool-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.tool-icon {
  font-size: 24px;
  width: 32px;
  text-align: center;
}

.tool-name {
  font-weight: 500;
  color: #303133;
  margin-bottom: 4px;
}

.tool-description {
  font-size: 12px;
  color: #909399;
  line-height: 1.4;
}

/* ÂàÜÈ°µ */
.pagination-wrapper {
  margin-top: 20px;
  text-align: right;
}

/* ÂìçÂ∫îÂºèËÆæËÆ° */
@media (max-width: 768px) {
  .page-header {
    flex-direction: column;
    gap: 16px;
  }

  .header-actions {
    width: 100%;
    justify-content: flex-end;
  }

  .tool-info {
    flex-direction: column;
    align-items: flex-start;
    gap: 4px;
  }

  .tool-icon {
    width: auto;
  }
}
</style>
